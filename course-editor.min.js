!function(e){function t(){var t=e(this),i=e(".lp-course-sale_start-field, .lp-course-sale_end-field");return"_lp_sale_price_schedule"===t.attr("id")?(e(this).hide(),i.removeClass("hide-if-js"),e(window).trigger("resize.calculate-tab")):(e("#_lp_sale_price_schedule").show(),i.addClass("hide-if-js").find("#_lp_sale_start, #_lp_sale_end").val(""),e(window).trigger("resize.calculate-tab"),e("#_lp_sale_start, #_lp_sale_end").siblings(".error").remove()),!1}function i(s){return new Vue({el:"#frontend-editor",data:function(){return{item:{id:0},showSettings:!1,showModalSelectItemsToggle:!1,xyz:{show:!1},modalData:null,activity:!1,activityType:"",newCategory:{id:0,name:"",parent:0},formData:{},postTitle:"",e_message:"",handleStatus:-1,el_post_title:null,el_lp_course_forum:null}},events:{getStore:function(){return this.$store}},computed:{countItems:function(){return 10},sections:function(){return this.$dataStore().sections},categories:{get:function(){return this.$dataStore().categories},set:function(e){this.$dataStore().categories=e}},flattenCategories:{get:function(){return this.$dataStore().flattenCategories},set:function(e){this.$dataStore().flattenCategories=e}}},watch:{categories:{handler:FE_Helpers.debounce(function(){this.updateCourseCategories()},300,this),deep:!0}},created:function(){setTimeout(function(e){e.init.apply(e)},10,this),this.__$store=s,this.$request=new FE_Helpers.Request(this.$store(),{course_ID:this.$dataStore().course_ID}),this.$on("select-item",function(e){})},mounted:function(){var i,s,o,n,r,a=this;a.getElementsViaJquery(),i=this.$el,s=e(i).find(".rwmb-datetime").each(function(){e(this).removeClass("hasDatepicker").datetimepicker(e.extend({},{onSelect:function(){var e=Date.parse(o[0].value),t=Date.parse(o[1].value),i=Date.now(),s=o.eq(0).parent(".rwmb-input"),a=o.eq(1).parent(".rwmb-input");r=!1,o[0].value&&isNaN(e)?n(s,"start_date_invalid"):o[1].value&&isNaN(t)?n(a,"end_date_invalid"):o[1].value&&t<i?n(a,"notice_sale_start_date"):o[0].value&&o[1].value&&e>=t&&n(a,"notice_sale_start_date"),r||(s.find(".error").remove(),a.find(".error").remove())}},e(this).data("options")))}).filter(function(){return""!==this.value}),o=e("#_lp_sale_start, #_lp_sale_end"),n=function(t,i){var s=lpAdminCourseEditorSettings.i18n[i]||i,o=e(t).find('input[type="text"]');e(t).find(".error").remove(),e('<div class="error">'+s+"</div>").insertAfter(o),r=!0},r=!1,e(document).off("change","#_lp_sale_start").off("change","#_lp_sale_end").on("click","#_lp_sale_price_schedule",t).on("click","#_lp_sale_price_schedule_cancel",t),s.length&&e("#_lp_sale_price_schedule").trigger("click"),e(".learn-press-tip").LP("QuickTip"),a.postTitle=a.el_post_title.val(),e(document).on("fe.start-activity",function(){a.activity=!0}).on("fe.stop-activity",function(){a.activity=!1}),e(document).on("FE.request-start",function(e,t){t&&(a.activityTimeout&&clearTimeout(a.activityTimeout),a.setActivity(t.__activity))}).on("FE.request-completed",function(t,i){i&&(a.handleStatus=i.code,a.e_message=i.message,e("#e-update-activity").hide(),setTimeout(function(){a.handleStatus=-1,a.setActivity(!1)},1e3))}),"undefined"!=typeof tinymce&&setTimeout(function(){var t=tinymce.get("post_content");t&&t.on("Change KeyUp",function(t,i){e("#"+this.settings.id).val(this.getContent())})},1e3),e(this.$el).addClass("ready"),e(document).trigger("FE.editor-rendered")},methods:i.Methods,$store:s})}Vue.component("e-course-category",{template:"#tmpl-e-course-category",props:["categories"],methods:{hasCategories:function(){return!e.isEmptyObject(this.categories)}}}),Vue.component("e-course-category-option-deep",{template:"#tmpl-e-course-category-option-deep",props:["categories"],mounted:function(){},methods:{hasCategories:function(){return!e.isEmptyObject(this.categories)}}}),i.Methods={getElementsViaJquery:function(){this.el_post_title=e("input[name=post_title]"),this.el_lp_course_forum=e("#_lp_course_forum")},updateCourse:function(t=""){var i=this,s=e(i.$el).serializeJSON();void 0!==s.post_title&&(0===s.post_title.length?alert("Please enter Course title"):("publish"==t&&(s.post_status=t),i.$emit("update-item-metas"),FE_Helpers.Course_Editor_Request("","update_course",e.extend({},s,{__activity:!0})).then(function(e){if(1===e.code){if(null!=i.el_lp_course_forum&&void 0!==e.data.meta._lp_course_forum){var t=e.data.meta._lp_course_forum;i.el_lp_course_forum.find('option[value="'+t.id+'"]').length||i.el_lp_course_forum.append('<option value="'+t.id+'">'+t.name+"</option>"),i.el_lp_course_forum.val(t.id)}}else alert(e.message)})))},addItem:function(e){this.$items||(this.$items={},this.item=e.item),this.$items[e.itemId]=e},getItem:function(e){return isNaN(e)&&e.itemId?this.$items[e.itemId]:this.$items[e]},init:function(){var t=0,i=e(this.$el).find(".e-tab").each(function(){var i=e(this).find(".e-tab-label");t>0&&i.css("left",t),t+=i.outerWidth()}),s=i.filter('[data-name="'+this.$dataStore().active_tab+'"]');s.length||(s=i.first()),this.selectTab(null,s);var o=this.isEdit();o||(o=this.$(".e-section-item:first").data("id")),o&&this.$items&&this.$items[o]&&this.openItemSettings(this.$items[o])},isEdit:function(){var e,t=location.href.match(/edit-post\/[0-9]+\/([0-9]+)/);return t&&t[1]&&(e=t[1]),e},isCourse:function(){var e,t=location.href.match(/edit-post\/([0-9]+).*/);return t&&(t[2]?e=t[2]:t[1]&&(e=t[1])),e},hasCategory:function(){return Object.values(this.$dataStore().categories).length},updateCourseCategories:function(){var e,t=[];function i(e){var s;if(e.nodes)for(s in e.nodes)e.nodes.hasOwnProperty(s)&&(e.nodes[s].selected&&t.push(e.nodes[s].id),i(e.nodes[s]))}for(e in this.categories)this.categories.hasOwnProperty(e)&&(this.categories[e].selected&&t.push(this.categories[e].id),i(this.categories[e]));FE_Helpers.startActivity(),FE_Helpers.Course_Editor_Request("","update-course-categories",{categories:t}).then(function(e){},function(e){FE_Helpers.stopActivity()})},getCatOptionValue:function(e){return"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".repeat(e.deep-1)+e.name},selectTab:function(t,i){var s;if((i=i||e(t.target).closest(".e-tab")).length&&!i.hasClass("active")){i.addClass("active").siblings().removeClass("active");for(s in this.$request("","fe/active-tab",{tab:i.data("name")}),e("#frontend-editor").removeClass(i.siblings().map(function(){return e(this).attr("data-name")+"-active"}).get().join(" ")).addClass(i.attr("data-name")+"-active"),tinyMCEPreInit.qtInit)FE_Helpers.QuickTags(s,tinyMCEPreInit.qtInit[s]);e(window).trigger("resize.frontend-editor-settings")}},countItems:function(){return this.$dataStore().countItems},getItemIds:function(){var t=[];return e.each(this.$dataStore().sections,function(){t=t.concat(this.items.listPluck("id"))}),t},openItemSettings:function(t,i){e(document).triggerHandler("LP.close-item-settings",[this.item]),this.showSettings=!0,this.item=t.item;var s=this.$dataStore("coursePermalink")+"/"+this.item.id+"/";s&&LP.setUrl(s)},closeItemSettings:function(){this.showSettings=!1},openModelSelectItems:function(e){this.showModalSelectItemsToggle=!0,this.xyz.show=!0,this.modalData=e},setActivity:function(t){switch(e.type(t)){case"boolean":case"string":this.activity=t,this.activityType="";break;case"object":this.activity=t.message,this.activityType=t.type}},currentUserCanPublishCourse:function(){var e=this.$dataStore();return"no"===e.settings.reviewCourseBeforePublish||("publish"===e.courseStatus||"publish"===e.courseStatus)},_deleteCourse:function(t,i,s,o){t.preventDefault(),confirm(FE_Localize.get("confirm_trash_course"))&&(e(t.target).addClass("icon icon-ajax").closest(".e-course-actions").css("visibility","visible"),FE_Helpers.Course_Editor_Request("","trash-course",{course_ID:i,permanently:s,deleteItems:o}).then(function(e){1==e.code?LP.reload():alert(e.message)}))},_restoreCourse:function(t,i){t.preventDefault(),e(t.target).addClass("icon icon-ajax").closest(".e-course-actions").css("visibility","visible"),FE_Helpers.Course_Editor_Request("","restore-course",{course_ID:i}).then(function(e){e&&e.course_ID&&LP.reload()})},_addCategory:function(e){if(this.newCategory.name){var t=this;FE_Helpers.Course_Editor_Request("","add-new-category",{category:this.newCategory}).then(function(e){e&&e.cats&&Vue.set(t,"categories",e.cats)}),this.newCategory={}}}},i.Methods=e.extend({},FE_Base.Store_Methods,i.Methods),e(document).ready(function(){window.FE_Course_Editor=i(window.FE_Course_Store),window.FE_Helpers.Course_Editor_Request=new FE_Helpers.Request(FE_Course_Store,{course_ID:FE_Course_Store.getters.course_ID})}),e(document).on("mousedown",function(){e(this).data("mouse_hold_time_start",Date.now())}).on("mouseup",function(t){var i=Date.now()-e(this).data("mouse_hold_time_start");e(t.target).data("mouse_hold_time",i)}),Object.defineProperty(Array.prototype,"findElementByField",{value:function(t,i,s,o){return this.find(function(n,r){var a=!1;if(0==r)if(e.isArray(s))for(;s.length;)s.pop();else for(var u in s)delete s[u];switch(o){case"===":a=n[t]===i;break;default:a=e.isFunction(o)?o.apply(this,[n,i]):n[t]==i}return!!a&&(e.isArray(s)?(s.push(n),s.push(r)):(s.value=n,s.position=r),!0)})}}),Object.defineProperty(Array.prototype,"random",{value:function(){return this[(e=0,t=this.length-1,Math.floor(Math.random()*(t-e+1))+e)];var e,t}}),Object.defineProperty(Array.prototype,"diffArray",{value:function(e){var t,i,s=[],o=[],n=[];for(t=0,i=this.length;t<i;t++)s.push(""+this[t]);for(t=0,i=e.length;t<i;t++)o.push(""+e[t]);for(t=0,i=(s=s.filter(function(e){return-1===o.indexOf(e)})).length;t<i;t++)for(var r=0,a=this.length;r<a;r++)this[r]==s[t]&&n.push(this[r]);return n}}),Object.__proto__.random=function(){var e,t;this.values();return this[(e=0,t=this.length-1,Math.floor(Math.random()*(t-e+1))+e)]},e(window).on("resize.fe",FE_Helpers.debounce(function(){var t=e("#wpadminbar").outerHeight(),i=e("#e-browse-items"),s=i.closest(".e-settings-window"),o=i.prev(),n=e(".e-item-settings-head").outerHeight(),r=e(".e-item-settings-footer").outerHeight(),a=e(".e-wrapper-filter").outerHeight();e("#frontend-editor, #e-page-header").css("top",t),o.length&&i.css({"max-height":s.height()-n-r-a-25})},300)),e(document).on("FE.count-question-answers",function(e,t,i){if("fill_in_blank"===i.question.type)try{t=i.question.answers[0].blanks.length}catch(e){t=0}return t})}(jQuery);