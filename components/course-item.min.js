!function(t){"use strict";Vue.component("e-course-item",{template:"#tmpl-e-course-item",props:["section","item","selected","position","placeholder"],data:function(){return{id:function(){return this.item.id},xxxxx:!1,focused:0}},computed:{itemId:function(){return this.item.id},itemTypes:function(){for(var t=[],e=this.getItemTypes(),i=0,s=e.length;i<s;i++)e[i].type===this.item.type?t.unshift(e[i]):t.push(e[i]);return t}},created:function(){this.item||(this.item={type:"lp_lesson",title:""})},watch:{"item.preview":function(t){}},mounted:function(){this.$root.addItem(this),this.$parent.$parent.$on("pressTitle",this.onPressTitle),this.$input=t(this.$el).find(".item-title"),this.$input.data("$instance",this),t(this.$el).data("$instance",this),this.isNew()&&this.focus(),t(this.$el).find(".e-quick-drop > li").droppable({drop:function(t,e){}}),this.watchGeneralChange()},methods:t.extend({},FE_Base.Store_Methods,{watchGeneralChange:function(){var t,e=["title","content"],i=e.length;for(t=0;t<i;t++)this.$watch("item."+e[t],function(t,e){return function(i){t.updateGeneralProps(e,i)}}(this,e[t]))},isNew:function(){return isNaN(this.item.id)},updateGeneralProps:FE_Helpers.debounce(function(t,e){this.item.id&&this.$dispatch("updatePost",{post_ID:this.item.id,prop:t,propContent:e}).then(function(t){t.result})},300,this),onPressTitle:function(e,i){var s=null;if(t(e.target).is(this.$input)){switch(i.code){case 13:if(e.preventDefault(),this.placeholder){var n=this.$(".item-title").val();n&&(this.$parent.addNewItem(99999,{title:n,type:this.item.type}),FE_Helpers.debounce(function(t){t.$().find(".item-title").focus()},40)(this),this.item.title="")}else i.shift&&i.ctrl?this.$parent.moveNextInput():i.ctrl?this.$parent.addNewItem(this):(s=t(this.$el).next().find(".item-title").focus()).length?s.data("$instance").onFocus():this.$parent.addNewItem(this);return;case 27:this.remove();break;case 8:""===(s=t(i.el)).val()&&i.countFromEmpty>1&&s.data("$instance").remove()}this.onFocus()}},focus:function(){var e=t(this.$el).find(".item-title").focus();return!!e.length&&(e.data("$instance").onFocus("focus"),e)},onFocus:function(t){this.focused||(this.focused=!0,this.$emit("onFocusItem",this),this.$emit("openItemSettings",this))},onBlur:function(t){this.focused&&(this.focused=!1)},remove:function(){this.$parent.removeItem(this)},itemClasses:function(){var t=["e-section-item","e-sort-item",this.item.type];return this.isNew()&&t.push("new-item"),this.selected&&t.push("e-selected"),this.getItemTypes().length>2&&t.push("d23e12fd"),this.placeholder&&t.push("placeholder"),this.$root.item&&this.$root.item.id===this.itemId&&t.push("e-selected"),t},getId:function(){return this.item.id},getItemTypes:function(){return this.$root.$store().getters.courseItemTypes},itemSwitchClass:function(t){var e=[t.type,t.icon];return t.type==this.item.type&&e.push("current"),e},openSettings:function(){this.$emit("openItemSettings",this)},getPosition:function(){var e=t(this.$el);return e.parent().children().index(e)},getSection:function(){return this.$parent.section},supportPreview:function(){return-1!==t.inArray(this.item.type,this.$dataStore().supports.preview)},countQuestions:function(){return this.item.questions?this.item.questions.length:0},getInputPlaceholderText:function(t){for(var e=this.$dataStore("course_item_types"),i=0,s=e.length;i<s;i++)if(e[i].type===this.item.type)return e[i].placeholder||t;return t},_switchType:function(t,e){this.isNew()&&(this.item.type=e),this.$(".item-title").focus()},_move:function(e,i){if("left"===FE_Helpers.getKeyboard(e).button){var s=!1;t(e.target).data("mouse_hold_time")>1100&&(s=!0),this.$emit("move-item",[this,i,s])}},_startAnim:function(e,i){"left"===FE_Helpers.getKeyboard(e).button&&t(e.target).addClass("anim")},_delete:function(e){if("left"===FE_Helpers.getKeyboard(e).button){var i=!1;t(e.target).data("mouse_hold_time")>1100&&(i=!0),this.$emit("delete-item",[this.item.id,i,this])}},_stopAnim:function(e,i){"left"===FE_Helpers.getKeyboard(e).button&&t(e.target).removeClass("anim")},_toggleMoreTypes:function(e,i){"out"==i?FE_Helpers.debounce(function(e){t(e.$el).removeClass("show-more-types")},2e3)(this):t(this.$el).toggleClass("show-more-types")},_select:function(t){FE_Helpers.getKeyboard(t).ctrl?this.$emit("select-item",[t,this]):this.$emit("deselect-item",[t,this])},_removeSelected:function(t,e){this.$emit("select-item",[t,this])},_addItems:function(e){var i=!1;t(e.target).data("mouse_hold_time")>1100&&(i=!0),i?this.$emit("add-items",[e,this]):this.$parent.addNewItem(this)},_preview:function(){this.item.settings._lp_preview="yes"===this.item.settings._lp_preview?"no":"yes",this.$dispatch("toggleItemPreview",{item_ID:this.item.id,isPreview:this.item.settings._lp_preview})}})})}(jQuery);